<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:viewmodels="clr-namespace:Yeetmedia3.ViewModels"
             x:Class="Yeetmedia3.Views.DotnetRocksView"
             x:DataType="viewmodels:DotnetRocksViewModel"
             Title=".NET Rocks! Podcast">

    <Grid RowDefinitions="Auto,Auto,Auto,*,Auto" Padding="10">

        <!-- Header -->
        <Label Grid.Row="0"
               Text=".NET Rocks! Podcast"
               FontSize="24"
               FontAttributes="Bold"
               HorizontalOptions="Center"
               TextColor="{AppThemeBinding Light=#512BD4, Dark=#9D71FF}"
               Margin="0,0,0,10"/>

        <!-- Episode Input and Action Buttons Row -->
        <Grid Grid.Row="1"
              ColumnDefinitions="*,Auto,Auto,Auto,Auto"
              ColumnSpacing="5"
              Margin="0,0,0,10">

            <!-- Episode Number Input -->
            <Entry Grid.Column="0"
                   x:Name="EpisodeNumberEntry"
                   Text="{Binding EpisodeNumber}"
                   Placeholder="Episode #"
                   Keyboard="Numeric"
                   FontSize="16"
                   VerticalOptions="Center"
                   BackgroundColor="{AppThemeBinding Light=#F8F8F8, Dark=#2A2A2A}"/>

            <!-- Download Button -->
            <Button Grid.Column="1"
                    Text="â¬‡"
                    Command="{Binding DownloadEpisodeCommand}"
                    BackgroundColor="{AppThemeBinding Light=#28A745, Dark=#20C940}"
                    TextColor="White"
                    WidthRequest="44"
                    HeightRequest="44"
                    CornerRadius="22"
                    FontSize="20"
                    ToolTipProperties.Text="Download Episode"
                    IsEnabled="{Binding IsDownloading, Converter={StaticResource InverseBoolConverter}}"/>

            <!-- Load Episode Button -->
            <Button Grid.Column="2"
                    Text="â–¶"
                    Command="{Binding LoadEpisodeCommand}"
                    BackgroundColor="{AppThemeBinding Light=#512BD4, Dark=#9D71FF}"
                    TextColor="White"
                    WidthRequest="44"
                    HeightRequest="44"
                    CornerRadius="22"
                    FontSize="20"
                    ToolTipProperties.Text="Load in Player"
                    IsVisible="{Binding IsEpisodeCached}"/>

            <!-- Actions Button -->
            <Button Grid.Column="3"
                    Text="â‹®"
                    Command="{Binding ShowActionsCommand}"
                    BackgroundColor="{AppThemeBinding Light=#6C757D, Dark=#5A6268}"
                    TextColor="White"
                    WidthRequest="44"
                    HeightRequest="44"
                    CornerRadius="22"
                    FontSize="20"
                    ToolTipProperties.Text="More Actions"/>
        </Grid>

        <!-- Episode Info Section -->
        <Border Grid.Row="2"
                BackgroundColor="{AppThemeBinding Light=#F0F8FF, Dark=#1A2332}"
                Stroke="{AppThemeBinding Light=#B0D4FF, Dark=#2E4E7E}"
                StrokeThickness="1"
                Padding="10"
                Margin="0,0,0,8"
                IsVisible="{Binding EpisodeTitle, Converter={StaticResource StringToBoolConverter}}">

            <VerticalStackLayout Spacing="5">
                <Label Text="{Binding EpisodeTitle}"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light=#333333, Dark=#FFFFFF}"
                       LineBreakMode="WordWrap"/>

                <Label Text="{Binding EpisodeDescription}"
                       FontSize="13"
                       TextColor="{AppThemeBinding Light=#666666, Dark=#CCCCCC}"
                       LineBreakMode="WordWrap"
                       MaxLines="2"/>

                <HorizontalStackLayout Spacing="15">
                    <Label FontSize="12"
                           TextColor="Gray">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="Published: "/>
                                <Span Text="{Binding EpisodePublishDate, StringFormat='{0:MMM dd, yyyy}'}"
                                      FontAttributes="Bold"/>
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>

                    <Label Text="âœ“ Cached"
                           FontSize="12"
                           TextColor="Green"
                           FontAttributes="Bold"
                           IsVisible="{Binding IsEpisodeCached}"/>
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </Border>

        <!-- MediaElement for audio/video playback -->
        <toolkit:MediaElement x:Name="MediaPlayer"
                              Grid.Row="3"
                              IsVisible="{Binding IsEpisodeCached}"
                              ShouldAutoPlay="False"
                              ShouldShowPlaybackControls="True"
                              VerticalOptions="Fill"
                              HorizontalOptions="Fill"
                              BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#1E1E1E}"
                              Margin="0,5,0,5" />

        <!-- Placeholder when no episode is loaded -->
        <VerticalStackLayout Grid.Row="3"
                             IsVisible="{Binding IsEpisodeCached, Converter={StaticResource InverseBoolConverter}}"
                             VerticalOptions="Center"
                             HorizontalOptions="Center"
                             Spacing="10">
            <Label Text="ðŸŽµ"
                   FontSize="60"
                   HorizontalOptions="Center"
                   TextColor="{AppThemeBinding Light=#CCCCCC, Dark=#666666}"/>
            <Label Text="Download an episode to play"
                   FontSize="16"
                   HorizontalOptions="Center"
                   TextColor="{AppThemeBinding Light=#999999, Dark=#777777}"/>
        </VerticalStackLayout>

        <!-- Status/Loading Section with Progress Bar Background -->
        <Border Grid.Row="4"
                BackgroundColor="{AppThemeBinding Light=#FFF9E6, Dark=#3A3A2A}"
                Stroke="{AppThemeBinding Light=#FFE4B5, Dark=#5A5A3A}"
                StrokeThickness="1"
                Padding="0"
                Margin="0,8,0,0">
            <Grid>
                <!-- Progress bar in background -->
                <ProgressBar Progress="{Binding DownloadProgress}"
                             VerticalOptions="Fill"
                             HorizontalOptions="Fill"
                             ProgressColor="{AppThemeBinding Light=#FFE4B580, Dark=#5A5A3A80}"
                             BackgroundColor="Transparent"
                             IsVisible="{Binding IsDownloading}"/>

                <!-- Status content on top -->
                <HorizontalStackLayout Spacing="10"
                                       Padding="10"
                                       BackgroundColor="Transparent">
                    <ActivityIndicator IsRunning="{Binding IsLoading}"
                                       IsVisible="{Binding IsLoading}"
                                       Color="#512BD4"
                                       WidthRequest="20"
                                       HeightRequest="20"/>

                    <ActivityIndicator IsRunning="{Binding IsDownloading}"
                                       IsVisible="{Binding IsDownloading}"
                                       Color="#4285F4"
                                       WidthRequest="20"
                                       HeightRequest="20"/>

                    <Label Text="{Binding StatusMessage}"
                           VerticalOptions="Center"
                           FontSize="14"
                           TextColor="{AppThemeBinding Light=#666666, Dark=#CCCCCC}"/>

                    <!-- Download percentage when downloading -->
                    <Label Text="{Binding DownloadProgressPercent}"
                           VerticalOptions="Center"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=#512BD4, Dark=#9D71FF}"
                           IsVisible="{Binding IsDownloading}"/>
                </HorizontalStackLayout>
            </Grid>
        </Border>

    </Grid>

</ContentPage>